<!DOCTYPE html>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Fallback to default mdbook template -->
        
        <meta name="robots" content="noindex,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8">
        <title>Migrating from Lua - LuaNext Documentation</title>
        <script>
            var theme = localStorage.getItem("mdbook-theme");
            if (theme === null || theme === undefined) { theme = "light"; }
            var html = document.querySelector("html");
            html.classList.remove("light");
            html.classList.add(theme);
        </script>
        <meta name="description" content="A typed superset of Lua with gradual typing, inspired by TypeScript">
        <link rel="icon" href="favicon.svg">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/custom.css">
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

    </head>
    <body>
        <!-- Provide the book title to JavaScript -->
        <script>
            window.book = window.book || {};
            window.book.language = "en";
        </script>

        <div id="book" class="book">
            <div class="book-inner">

            <nav role="navigation" aria-label="Table of contents" class="sidebar">
                <ol class="chapter"><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="introduction.html">Introduction</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Language</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/basics.html"><strong aria-hidden="true">1.</strong> Basics</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/control-flow.html"><strong aria-hidden="true">2.</strong> Control Flow</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/functions.html"><strong aria-hidden="true">3.</strong> Functions</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/type-system.html"><strong aria-hidden="true">4.</strong> Type System</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/classes.html"><strong aria-hidden="true">5.</strong> Classes</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/interfaces.html"><strong aria-hidden="true">6.</strong> Interfaces</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/enums.html"><strong aria-hidden="true">7.</strong> Enums</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/modules.html"><strong aria-hidden="true">8.</strong> Modules</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/error-handling.html"><strong aria-hidden="true">9.</strong> Error Handling</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/pattern-matching.html"><strong aria-hidden="true">10.</strong> Pattern Matching</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/decorators.html"><strong aria-hidden="true">11.</strong> Decorators</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/advanced-types.html"><strong aria-hidden="true">12.</strong> Advanced Types</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/operators.html"><strong aria-hidden="true">13.</strong> Operators</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Guides</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="guides/migrating-from-lua.html"><strong aria-hidden="true">14.</strong> Migrating from Lua</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="guides/lua-targets.html"><strong aria-hidden="true">15.</strong> Lua Targets</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Reference</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/cli.html"><strong aria-hidden="true">16.</strong> CLI</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/configuration.html"><strong aria-hidden="true">17.</strong> Configuration</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/standard-library.html"><strong aria-hidden="true">18.</strong> Standard Library</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/utility-types.html"><strong aria-hidden="true">19.</strong> Utility Types</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/reflection.html"><strong aria-hidden="true">20.</strong> Reflection API</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/error-codes.html"><strong aria-hidden="true">21.</strong> Error Codes</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/grammar.html"><strong aria-hidden="true">22.</strong> Grammar</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/keywords.html"><strong aria-hidden="true">23.</strong> Keywords</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Contributing</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="contributing/setup.html"><strong aria-hidden="true">24.</strong> Getting Started</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">API Reference</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="api/index.html"><strong aria-hidden="true">25.</strong> Rust API Docs</a></span></li></ol>
            </nav>

            <div id="page-wrapper" class="page-wrapper">

                <div class="page-inner">

                <section class="normal" id="main">
                    <h1 id="migrating-from-lua"><a class="header" href="#migrating-from-lua">Migrating from Lua</a></h1>
<p>This guide helps you migrate existing Lua code to LuaNext, taking advantage of static typing and modern features while maintaining compatibility.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>LuaNext is a <strong>gradual typing</strong> system, meaning you can:</p>
<ol>
<li>Start with zero type annotations (valid Lua is valid LuaNext)</li>
<li>Add types incrementally where they provide value</li>
<li>Gradually enable modern features (OOP, FP, decorators)</li>
<li>Maintain full compatibility with existing Lua code</li>
</ol>
<h2 id="migration-strategy"><a class="header" href="#migration-strategy">Migration Strategy</a></h2>
<h3 id="quick-start-three-step-migration"><a class="header" href="#quick-start-three-step-migration">Quick Start: Three-Step Migration</a></h3>
<ol>
<li><strong>Rename files</strong> — Change <code>.lua</code> to <code>.luax</code></li>
<li><strong>Compile</strong> — Run <code>luanext your-file.luax</code> (should work immediately)</li>
<li><strong>Add types gradually</strong> — Start with function signatures, then variables</li>
</ol>
<h3 id="recommended-approach"><a class="header" href="#recommended-approach">Recommended Approach</a></h3>
<p>For large codebases:</p>
<ol>
<li><strong>Start at the edges</strong> — Add types to public APIs first</li>
<li><strong>Work inward</strong> — Type internal modules once APIs are typed</li>
<li><strong>Use <code>unknown</code></strong> — For complex external data, use <code>unknown</code> and narrow</li>
<li><strong>Enable features incrementally</strong> — Turn on <code>strictNullChecks</code>, OOP, FP as needed</li>
</ol>
<h2 id="basic-syntax-changes"><a class="header" href="#basic-syntax-changes">Basic Syntax Changes</a></h2>
<h3 id="variable-declarations"><a class="header" href="#variable-declarations">Variable Declarations</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">local x = 10
local name = "Alice"
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- Mutable variables (same as Lua)
local x: number = 10
local name: string = "Alice"

-- Immutable variables (new)
const PI: number = 3.14159
const status: string = "active"
</code></pre>
<p><strong>Migration tip:</strong> Use <code>const</code> for values that never change. This catches accidental reassignment bugs and enables better type inference.</p>
<h3 id="function-declarations"><a class="header" href="#function-declarations">Function Declarations</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">function add(a, b)
    return a + b
end

function greet(name)
    print("Hello, " .. name)
end
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- Add parameter and return types
function add(a: number, b: number): number
    return a + b
end

function greet(name: string): void
    print("Hello, " .. name)
end

-- Types can be inferred for simple cases
function double(x: number)  -- return type inferred as number
    return x * 2
end
</code></pre>
<p><strong>Migration tip:</strong> Start by adding types to function signatures. This documents intent and catches type errors at call sites.</p>
<h3 id="table-types"><a class="header" href="#table-types">Table Types</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">local point = {x = 10, y = 20}

function distance(p1, p2)
    local dx = p2.x - p1.x
    local dy = p2.y - p1.y
    return math.sqrt(dx * dx + dy * dy)
end
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- Define table shape with interface
interface Point
    x: number
    y: number
end

const point: Point = {x = 10, y = 20}

function distance(p1: Point, p2: Point): number
    const dx = p2.x - p1.x
    const dy = p2.y - p1.y
    return math.sqrt(dx * dx + dy * dy)
end

-- Or use inline types for one-offs
const config: {host: string, port: number} = {
    host = "localhost",
    port = 8080
}
</code></pre>
<p><strong>Migration tip:</strong> Create interfaces for tables used in multiple places. Use inline types for local, one-off tables.</p>
<h3 id="arrays"><a class="header" href="#arrays">Arrays</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">local numbers = {1, 2, 3, 4, 5}
local names = {"Alice", "Bob", "Charlie"}
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- Add array type annotations
const numbers: number[] = {1, 2, 3, 4, 5}
const names: string[] = {"Alice", "Bob", "Charlie"}

-- Generic syntax (equivalent)
const items: Array&lt;string&gt; = {"a", "b", "c"}
</code></pre>
<h2 id="handling-nil"><a class="header" href="#handling-nil">Handling Nil</a></h2>
<h3 id="nullable-types"><a class="header" href="#nullable-types">Nullable Types</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">local value = nil
value = "hello"

function findUser(id)
    -- May return nil
    return users[id]
end
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- Explicitly allow nil with union type
local value: string | nil = nil
value = "hello"

function findUser(id: string): User | nil
    return users[id]
end

-- Check for nil before use
const user = findUser("123")
if user ~= nil then
    print(user.name)  -- user is User here (narrowed)
end
</code></pre>
<p><strong>Migration tip:</strong> Enable <code>strictNullChecks</code> in config to catch nil-related bugs. This forces explicit nil handling.</p>
<h3 id="optional-chaining-new-feature"><a class="header" href="#optional-chaining-new-feature">Optional Chaining (New Feature)</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">-- Verbose nil checking
local city = nil
if user ~= nil and user.address ~= nil then
    city = user.address.city
end
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- Optional chaining
const city = user?.address?.city  -- nil if any part is nil

-- Optional method calls
const result = obj?:method()  -- Only calls if obj is not nil
</code></pre>
<h2 id="replacing-metatables-with-classes"><a class="header" href="#replacing-metatables-with-classes">Replacing Metatables with Classes</a></h2>
<h3 id="lua-metatable-pattern"><a class="header" href="#lua-metatable-pattern">Lua Metatable Pattern</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">local Vector = {}
Vector.__index = Vector

function Vector.new(x, y)
    local self = setmetatable({}, Vector)
    self.x = x
    self.y = y
    return self
end

function Vector:add(other)
    return Vector.new(self.x + other.x, self.y + other.y)
end

function Vector:magnitude()
    return math.sqrt(self.x * self.x + self.y * self.y)
end

local v1 = Vector.new(1, 2)
local v2 = Vector.new(3, 4)
local v3 = v1:add(v2)
</code></pre>
<p><strong>LuaNext (with OOP enabled):</strong></p>
<pre><code class="language-lua">-- Class syntax replaces metatable boilerplate
class Vector(public x: number, public y: number)
    function add(other: Vector): Vector
        return Vector.new(self.x + other.x, self.y + other.y)
    end

    function magnitude(): number
        return math.sqrt(self.x * self.x + self.y * self.y)
    end
end

const v1 = Vector.new(1, 2)
const v2 = Vector.new(3, 4)
const v3 = v1:add(v2)
</code></pre>
<p><strong>Migration tip:</strong> Classes compile to metatables, so the generated code is similar to hand-written Lua. Class features are available by default.</p>
<h3 id="operator-overloading"><a class="header" href="#operator-overloading">Operator Overloading</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">function Vector:__add(other)
    return Vector.new(self.x + other.x, self.y + other.y)
end

Vector.__mul = function(self, scalar)
    return Vector.new(self.x * scalar, self.y * scalar)
end
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">class Vector(public x: number, public y: number)
    operator +(other: Vector): Vector
        return Vector.new(self.x + other.x, self.y + other.y)
    end

    operator *(scalar: number): Vector
        return Vector.new(self.x * scalar, self.y * scalar)
    end
end

const v1 = Vector.new(1, 2)
const v2 = Vector.new(3, 4)
const v3 = v1 + v2       -- Uses operator +
const v4 = v1 * 2        -- Uses operator *
</code></pre>
<h2 id="string-operations"><a class="header" href="#string-operations">String Operations</a></h2>
<h3 id="string-concatenation"><a class="header" href="#string-concatenation">String Concatenation</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">local message = "Hello, " .. name .. "! You are " .. age .. " years old."
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- Template strings (more readable)
const message = `Hello, ${name}! You are ${age} years old.`

-- Compiles to concatenation, same as Lua
-- local message = "Hello, " .. tostring(name) .. "! You are " .. tostring(age) .. " years old."
</code></pre>
<h2 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h2>
<h3 id="pcallxpcall-pattern"><a class="header" href="#pcallxpcall-pattern">pcall/xpcall Pattern</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">local success, result = pcall(function()
    return riskyOperation()
end)

if not success then
    print("Error: " .. result)
else
    print("Result: " .. result)
end
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- Try/catch syntax (compiles to pcall)
try
    const result = riskyOperation()
    print("Result: " .. result)
catch error
    print("Error: " .. error)
end

-- Try expression for simple fallbacks
const result = try riskyOperation() catch _ =&gt; defaultValue

-- Error chain operator (shorthand)
const result = riskyOperation() !! defaultValue
</code></pre>
<h2 id="module-system"><a class="header" href="#module-system">Module System</a></h2>
<h3 id="lua-modules"><a class="header" href="#lua-modules">Lua Modules</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">-- math-utils.lua
local M = {}

function M.add(a, b)
    return a + b
end

function M.multiply(a, b)
    return a * b
end

return M

-- main.lua
local utils = require("math-utils")
print(utils.add(5, 3))
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- math-utils.luax
export function add(a: number, b: number): number
    return a + b
end

export function multiply(a: number, b: number): number
    return a * b
end

-- main.luax
import {add, multiply} from "./math-utils"
print(add(5, 3))

-- Or import everything
import * as utils from "./math-utils"
print(utils.add(5, 3))
</code></pre>
<p><strong>Migration tip:</strong> The ES6-style module system compiles to Lua’s <code>require</code> and module pattern. It provides better tooling support (autocomplete, refactoring).</p>
<h2 id="control-flow-enhancements"><a class="header" href="#control-flow-enhancements">Control Flow Enhancements</a></h2>
<h3 id="pattern-matching"><a class="header" href="#pattern-matching">Pattern Matching</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">function getStatusMessage(code)
    if code == 200 then
        return "OK"
    elseif code == 404 then
        return "Not Found"
    elseif code == 500 then
        return "Internal Server Error"
    else
        return "Unknown Status"
    end
end
</code></pre>
<p><strong>LuaNext (with FP enabled):</strong></p>
<pre><code class="language-lua">function getStatusMessage(code: number): string
    return match code
        | 200 -&gt; "OK"
        | 404 -&gt; "Not Found"
        | 500 -&gt; "Internal Server Error"
        | _ -&gt; "Unknown Status"
    end
end
</code></pre>
<p><strong>Migration tip:</strong> Pattern matching and functional features are available by default. Pattern matching compiles to if-else chains, no runtime overhead.</p>
<h2 id="type-annotations-for-existing-apis"><a class="header" href="#type-annotations-for-existing-apis">Type Annotations for Existing APIs</a></h2>
<h3 id="standard-library"><a class="header" href="#standard-library">Standard Library</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">local result = table.concat(items, ", ")
local index = string.find(text, "pattern")
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- LuaNext provides types for standard library
const result: string = table.concat(items, ", ")
const index: number | nil = string.find(text, "pattern")

-- Type checker knows standard library signatures
table.insert(numbers, "wrong")  -- ❌ Type error
</code></pre>
<h3 id="external-libraries"><a class="header" href="#external-libraries">External Libraries</a></h3>
<p>For libraries without types:</p>
<pre><code class="language-lua">-- Declare types for external library
declare module "external-lib"
    export function process(data: string): number
    export interface Config
        timeout: number
        retries: number
    end
end

import {process, type Config} from "external-lib"

const result: number = process("data")
const config: Config = {timeout = 1000, retries = 3}
</code></pre>
<h2 id="configuration-for-migration"><a class="header" href="#configuration-for-migration">Configuration for Migration</a></h2>
<h3 id="gradual-adoption-config"><a class="header" href="#gradual-adoption-config">Gradual Adoption Config</a></h3>
<p>Start with minimal type checking:</p>
<pre><code class="language-yaml"># luanext.config.yaml
compilerOptions:
  target: "5.1"              # Match your Lua version
  strictNullChecks: false    # Allow nil anywhere (Lua default)
  enableDecorators: false    # Keep it simple
  outDir: "dist"
</code></pre>
<h3 id="progressive-strictness"><a class="header" href="#progressive-strictness">Progressive Strictness</a></h3>
<p>As you add types, increase strictness:</p>
<pre><code class="language-yaml">compilerOptions:
  target: "5.4"
  strictNullChecks: true     # Enable once nil handling is typed
  enableDecorators: true     # Enable for metadata features
  outDir: "dist"
</code></pre>
<h2 id="common-patterns"><a class="header" href="#common-patterns">Common Patterns</a></h2>
<h3 id="iterators"><a class="header" href="#iterators">Iterators</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">for i, value in ipairs(array) do
    print(i, value)
end

for key, value in pairs(table) do
    print(key, value)
end
</code></pre>
<p><strong>LuaNext (same syntax, with types):</strong></p>
<pre><code class="language-lua">const array: number[] = {1, 2, 3, 4, 5}

for i, value in ipairs(array) do
    -- i is number, value is number
    print(i, value)
end

interface Data
    [key: string]: any
end

const data: Data = {x = 1, y = 2}

for key, value in pairs(data) do
    -- key is string, value is any
    print(key, value)
end
</code></pre>
<h3 id="varargs"><a class="header" href="#varargs">Varargs</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">function sum(...)
    local total = 0
    for _, n in ipairs({...}) do
        total = total + n
    end
    return total
end
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">function sum(...numbers: number[]): number
    local total = 0
    for _, n in ipairs(numbers) do
        total = total + n
    end
    return total
end

print(sum(1, 2, 3, 4, 5))  -- 15
</code></pre>
<h3 id="callbacks"><a class="header" href="#callbacks">Callbacks</a></h3>
<p><strong>Lua:</strong></p>
<pre><code class="language-lua">function processItems(items, callback)
    for _, item in ipairs(items) do
        callback(item)
    end
end

processItems(numbers, function(n)
    print(n * 2)
end)
</code></pre>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">function processItems(items: number[], callback: (n: number) =&gt; void): void
    for _, item in ipairs(items) do
        callback(item)
    end
end

processItems(numbers, (n) =&gt; {
    print(n * 2)
})

-- Or with traditional syntax
processItems(numbers, function(n: number): void
    print(n * 2)
end)
</code></pre>
<h2 id="compatibility-considerations"><a class="header" href="#compatibility-considerations">Compatibility Considerations</a></h2>
<h3 id="lua-version-targeting"><a class="header" href="#lua-version-targeting">Lua Version Targeting</a></h3>
<p>LuaNext compiles to different Lua versions:</p>
<pre><code class="language-yaml">compilerOptions:
  target: "5.1"  # Uses compatibility patterns
  # OR
  target: "5.3"  # Uses integer type, bitwise operators
  # OR
  target: "5.4"  # Uses latest features
</code></pre>
<p><strong>5.1 → 5.4 differences:</strong></p>
<ul>
<li><strong>Integers</strong> — <code>integer</code> type is type-checked in 5.1/5.2, native in 5.3+</li>
<li><strong>Bitwise operators</strong> — Compile to bit library calls in 5.1/5.2, native in 5.3+</li>
<li><strong><code>goto</code></strong> — Available in 5.2+</li>
<li><strong>Integer division (<code>//</code>)</strong> — Emulated in 5.1/5.2, native in 5.3+</li>
</ul>
<h3 id="c-api-and-ffi"><a class="header" href="#c-api-and-ffi">C API and FFI</a></h3>
<p>LuaNext is <strong>source compatible</strong> only. For C extensions:</p>
<pre><code class="language-lua">-- Declare C module types
declare module "cjson"
    export function encode(data: any): string
    export function decode(json: string): any
end

import * as cjson from "cjson"

const json: string = cjson.encode({x = 1, y = 2})
</code></pre>
<h3 id="metatables-still-work"><a class="header" href="#metatables-still-work">Metatables Still Work</a></h3>
<p>LuaNext classes compile to metatables, so existing metatable code is compatible:</p>
<pre><code class="language-lua">class MyClass
    -- LuaNext class
end

-- Still accessible as metatable in generated Lua
local mt = getmetatable(MyClass.new())
print(mt.__index)  -- Works as expected
</code></pre>
<h2 id="migration-checklist"><a class="header" href="#migration-checklist">Migration Checklist</a></h2>
<h3 id="phase-1-setup"><a class="header" href="#phase-1-setup">Phase 1: Setup</a></h3>
<ul>
<li><input disabled="" type="checkbox"> Install LuaNext compiler</li>
<li><input disabled="" type="checkbox"> Rename <code>.lua</code> files to <code>.luax</code></li>
<li><input disabled="" type="checkbox"> Create <code>luanext.config.yaml</code> with minimal settings</li>
<li><input disabled="" type="checkbox"> Verify project compiles without errors</li>
</ul>
<h3 id="phase-2-add-types"><a class="header" href="#phase-2-add-types">Phase 2: Add Types</a></h3>
<ul>
<li><input disabled="" type="checkbox"> Add types to public API functions</li>
<li><input disabled="" type="checkbox"> Add types to complex data structures (interfaces)</li>
<li><input disabled="" type="checkbox"> Add types to frequently-used utility functions</li>
<li><input disabled="" type="checkbox"> Enable <code>strictNullChecks</code> when ready</li>
</ul>
<h3 id="phase-3-modern-features"><a class="header" href="#phase-3-modern-features">Phase 3: Modern Features</a></h3>
<ul>
<li><input disabled="" type="checkbox"> Convert metatables to classes</li>
<li><input disabled="" type="checkbox"> Add pattern matching for complex conditionals</li>
<li><input disabled="" type="checkbox"> Use decorators for metadata (enable with <code>enableDecorators: true</code>)</li>
</ul>
<h3 id="phase-4-refinement"><a class="header" href="#phase-4-refinement">Phase 4: Refinement</a></h3>
<ul>
<li><input disabled="" type="checkbox"> Add types to remaining untyped code</li>
<li><input disabled="" type="checkbox"> Enable all strict checks</li>
<li><input disabled="" type="checkbox"> Review and fix type errors</li>
<li><input disabled="" type="checkbox"> Document types for external consumers</li>
</ul>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="type-mismatch-errors"><a class="header" href="#type-mismatch-errors">“Type mismatch” errors</a></h3>
<p><strong>Problem:</strong> Lua allows mixing types, but LuaNext doesn’t.</p>
<p><strong>Solution:</strong> Use union types or type assertions:</p>
<pre><code class="language-lua">-- Union type
local value: string | number = getValue()

-- Type assertion (use sparingly)
const data = externalCall() as MyType
</code></pre>
<h3 id="cannot-assign-to-const"><a class="header" href="#cannot-assign-to-const">“Cannot assign to const”</a></h3>
<p><strong>Problem:</strong> Variable declared with <code>const</code> cannot be reassigned.</p>
<p><strong>Solution:</strong> Use <code>local</code> for mutable variables:</p>
<pre><code class="language-lua">local count = 0
count = count + 1  -- OK
</code></pre>
<h3 id="missing-nil-check"><a class="header" href="#missing-nil-check">“Missing nil check”</a></h3>
<p><strong>Problem:</strong> <code>strictNullChecks</code> requires explicit nil handling.</p>
<p><strong>Solution:</strong> Check for nil or use optional chaining:</p>
<pre><code class="language-lua">-- Explicit nil check
if value ~= nil then
    print(value.property)
end

-- Optional chaining
print(value?.property)
</code></pre>
<h3 id="module-not-found"><a class="header" href="#module-not-found">“Module not found”</a></h3>
<p><strong>Problem:</strong> Import path doesn’t match file structure.</p>
<p><strong>Solution:</strong> Use relative paths:</p>
<pre><code class="language-lua">-- From src/main.luax importing src/utils.luax
import {helper} from "./utils"

-- From src/main.luax importing src/lib/utils.luax
import {helper} from "./lib/utils"
</code></pre>
<h2 id="performance-considerations"><a class="header" href="#performance-considerations">Performance Considerations</a></h2>
<h3 id="zero-runtime-cost"><a class="header" href="#zero-runtime-cost">Zero Runtime Cost</a></h3>
<p>All LuaNext features compile to plain Lua with <strong>no runtime overhead</strong>:</p>
<ul>
<li><strong>Types</strong> — Erased at compile time</li>
<li><strong>Interfaces</strong> — Type-checking only, no runtime representation</li>
<li><strong>Classes</strong> — Compile to metatables (same as hand-written Lua)</li>
<li><strong>Pattern matching</strong> — Compiles to if-else chains</li>
<li><strong>Template strings</strong> — Compile to concatenation</li>
</ul>
<h3 id="same-performance-as-lua"><a class="header" href="#same-performance-as-lua">Same Performance as Lua</a></h3>
<pre><code class="language-lua">-- LuaNext
const result: number = add(5, 3)

-- Compiles to (same as hand-written Lua)
local result = add(5, 3)
</code></pre>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<ul>
<li><a href="../language/basics.html">Language Basics</a> — Core syntax and types</li>
<li><a href="../language/type-system.html">Type System</a> — Advanced type features</li>
<li><a href="../language/classes.html">Classes</a> — OOP with classes</li>
<li><a href="../language/pattern-matching.html">Pattern Matching</a> — Functional patterns</li>
<li><a href="../reference/configuration.html">Configuration</a> — Compiler options</li>
</ul>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="lua-targets.html">Lua Targets</a> — Targeting different Lua versions</li>
<li><a href="../reference/standard-library.html">Standard Library</a> — Typed Lua standard library</li>
<li><a href="../reference/cli.html">CLI Reference</a> — Command-line options</li>
</ul>

                </section>

                </div><!-- page-inner -->

            </div><!-- page-wrapper -->

            </div><!-- book-inner -->

            <!-- Version Selector -->
            <nav class="nav-wide-wrapper" aria-label="More">
                <a href="javascript:void(0)" id="menu-bar-wide" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </a>
            </nav>

            <!-- Version selector dropdown -->
            <div id="version-selector" class="version-selector">
                <select id="version-picker" onchange="switchVersion(this.value)" aria-label="Documentation version">
                    <option value="latest">Latest</option>
                </select>
            </div>

        </div><!-- book -->

        <!-- Custom scripts -->
        <script>
            // Version selector functionality
            function switchVersion(version) {
                const base = window.location.origin + '/luanext/';
                if (version === 'latest') {
                    window.location.href = base;
                } else {
                    window.location.href = base + version + '/';
                }
            }

            // Load versions.json and populate selector if it exists
            fetch('/luanext/versions.json')
                .then(response => response.json())
                .then(data => {
                    if (data.versions && data.versions.length > 1) {
                        const selector = document.getElementById('version-picker');
                        data.versions.forEach(v => {
                            if (v.version !== 'latest') {
                                const option = document.createElement('option');
                                option.value = 'v' + v.version;
                                option.textContent = 'v' + v.version;
                                selector.appendChild(option);
                            }
                        });
                    }
                })
                .catch(() => {
                    // versions.json not found (expected during initial setup)
                    // Selector will only show "Latest"
                });
        </script>

        <!-- mdBook scripts and content scripts -->
        <script src="js/clipboard.min.js" type="text/javascript"></script>
        <script src="js/highlight.js" type="text/javascript"></script>
        <script src="js/book.js" type="text/javascript"></script>

        <!-- Custom theme script -->
        <script src="js/custom-theme.js" type="text/javascript"></script>

        <script src="js/elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/lunr-en.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/search.js" type="text/javascript" charset="utf-8"></script>

    </body>
</html>
