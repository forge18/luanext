<!DOCTYPE html>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Fallback to default mdbook template -->
        
        <meta name="robots" content="noindex,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8">
        <title>Decorators - LuaNext Documentation</title>
        <script>
            var theme = localStorage.getItem("mdbook-theme");
            if (theme === null || theme === undefined) { theme = "light"; }
            var html = document.querySelector("html");
            html.classList.remove("light");
            html.classList.add(theme);
        </script>
        <meta name="description" content="A typed superset of Lua with gradual typing, inspired by TypeScript">
        <link rel="icon" href="favicon.svg">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/custom.css">
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

    </head>
    <body>
        <!-- Provide the book title to JavaScript -->
        <script>
            window.book = window.book || {};
            window.book.language = "en";
        </script>

        <div id="book" class="book">
            <div class="book-inner">

            <nav role="navigation" aria-label="Table of contents" class="sidebar">
                <ol class="chapter"><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="introduction.html">Introduction</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Language</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/basics.html"><strong aria-hidden="true">1.</strong> Basics</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/control-flow.html"><strong aria-hidden="true">2.</strong> Control Flow</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/functions.html"><strong aria-hidden="true">3.</strong> Functions</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/type-system.html"><strong aria-hidden="true">4.</strong> Type System</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/classes.html"><strong aria-hidden="true">5.</strong> Classes</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/interfaces.html"><strong aria-hidden="true">6.</strong> Interfaces</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/enums.html"><strong aria-hidden="true">7.</strong> Enums</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/modules.html"><strong aria-hidden="true">8.</strong> Modules</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/error-handling.html"><strong aria-hidden="true">9.</strong> Error Handling</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/pattern-matching.html"><strong aria-hidden="true">10.</strong> Pattern Matching</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/decorators.html"><strong aria-hidden="true">11.</strong> Decorators</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/advanced-types.html"><strong aria-hidden="true">12.</strong> Advanced Types</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/operators.html"><strong aria-hidden="true">13.</strong> Operators</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Guides</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="guides/migrating-from-lua.html"><strong aria-hidden="true">14.</strong> Migrating from Lua</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="guides/lua-targets.html"><strong aria-hidden="true">15.</strong> Lua Targets</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Reference</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/cli.html"><strong aria-hidden="true">16.</strong> CLI</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/configuration.html"><strong aria-hidden="true">17.</strong> Configuration</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/standard-library.html"><strong aria-hidden="true">18.</strong> Standard Library</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/utility-types.html"><strong aria-hidden="true">19.</strong> Utility Types</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/reflection.html"><strong aria-hidden="true">20.</strong> Reflection API</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/error-codes.html"><strong aria-hidden="true">21.</strong> Error Codes</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/grammar.html"><strong aria-hidden="true">22.</strong> Grammar</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/keywords.html"><strong aria-hidden="true">23.</strong> Keywords</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Contributing</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="contributing/setup.html"><strong aria-hidden="true">24.</strong> Getting Started</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">API Reference</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="api/index.html"><strong aria-hidden="true">25.</strong> Rust API Docs</a></span></li></ol>
            </nav>

            <div id="page-wrapper" class="page-wrapper">

                <div class="page-inner">

                <section class="normal" id="main">
                    <h1 id="decorators"><a class="header" href="#decorators">Decorators</a></h1>
<p>Decorators provide a way to annotate and modify classes and their members. They enable meta-programming patterns like logging, validation, dependency injection, and more.</p>
<h2 id="syntax"><a class="header" href="#syntax">Syntax</a></h2>
<pre><code class="language-lua">@decoratorName
@decoratorWithArgs(arg1, arg2)

-- On classes
@decorator
class ClassName
    -- ...
end

-- On class members
class ClassName
    @decorator
    property: Type

    @decorator
    function method(): void
        -- ...
    end

    @decorator
    get property(): Type
        -- ...
    end

    @decorator
    set property(value: Type)
        -- ...
    end

    @decorator
    operator +(other: Type): Type
        -- ...
    end
end
</code></pre>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="basic-decorator"><a class="header" href="#basic-decorator">Basic Decorator</a></h3>
<p>Simple decorator without arguments:</p>
<pre><code class="language-lua">function readonly(target: any, key: string): void
    -- Mark property as readonly
    print(`Marking ${key} as readonly on ${target}`)
end

class User
    @readonly
    id: string

    name: string

    constructor(id: string, name: string)
        self.id = id
        self.name = name
    end
end

const user = User.new("user-123", "Alice")
user.name = "Bob"  -- ✅ OK
-- user.id = "new-id"  -- ❌ Error: Cannot assign to readonly property
</code></pre>
<h3 id="decorator-with-arguments"><a class="header" href="#decorator-with-arguments">Decorator with Arguments</a></h3>
<p>Decorators can accept arguments:</p>
<pre><code class="language-lua">function deprecated(message: string): (target: any, key: string) =&gt; void
    return function(target, key)
        print(`Warning: ${key} is deprecated: ${message}`)
    end
end

class OldAPI
    @deprecated("Use newMethod() instead")
    function oldMethod(): void
        print("Old method")
    end

    function newMethod(): void
        print("New method")
    end
end

const api = OldAPI.new()
api:oldMethod()  -- Warning: oldMethod is deprecated: Use newMethod() instead
</code></pre>
<h3 id="class-decorator"><a class="header" href="#class-decorator">Class Decorator</a></h3>
<p>Decorate entire classes:</p>
<pre><code class="language-lua">function sealed(constructor: any): void
    -- Prevent class extension
    constructor.__sealed = true
end

@sealed
class FinalClass
    value: number

    constructor(value: number)
        self.value = value
    end
end

-- Error: Cannot extend sealed class
-- class Extended extends FinalClass
-- end
</code></pre>
<h3 id="method-decorator"><a class="header" href="#method-decorator">Method Decorator</a></h3>
<p>Add behavior to methods:</p>
<pre><code class="language-lua">function log(target: any, key: string, descriptor: any): void
    const originalMethod = descriptor.value

    descriptor.value = function(...)
        print(`Calling ${key} with arguments:`, ...)
        const result = originalMethod(...)
        print(`${key} returned:`, result)
        return result
    end
end

class Calculator
    @log
    function add(a: number, b: number): number
        return a + b
    end

    @log
    function multiply(a: number, b: number): number
        return a * b
    end
end

const calc = Calculator.new()
calc:add(5, 3)       -- Logs: Calling add with arguments: 5, 3
                      --       add returned: 8
calc:multiply(4, 2)  -- Logs: Calling multiply with arguments: 4, 2
                      --       multiply returned: 8
</code></pre>
<h3 id="property-decorator"><a class="header" href="#property-decorator">Property Decorator</a></h3>
<p>Modify property behavior:</p>
<pre><code class="language-lua">function validate(validator: (value: any) =&gt; boolean): (target: any, key: string) =&gt; void
    return function(target, key)
        const privateKey = "_" .. key

        -- Create getter
        target[`get_${key}`] = function(self)
            return self[privateKey]
        end

        -- Create setter with validation
        target[`set_${key}`] = function(self, value)
            if not validator(value) then
                error(`Invalid value for ${key}: ${value}`)
            end
            self[privateKey] = value
        end
    end
end

class User
    @validate(function(value) return #value &gt;= 3 end)
    name: string

    @validate(function(value) return value &gt;= 18 end)
    age: number

    constructor(name: string, age: number)
        self.name = name
        self.age = age
    end
end

const user = User.new("Alice", 30)
-- user.name = "AB"  -- ❌ Error: Invalid value for name: AB
-- user.age = 10     -- ❌ Error: Invalid value for age: 10
</code></pre>
<h3 id="multiple-decorators"><a class="header" href="#multiple-decorators">Multiple Decorators</a></h3>
<p>Apply multiple decorators (executed bottom-to-top):</p>
<pre><code class="language-lua">@decorator1
@decorator2
@decorator3
class MyClass
    -- Execution order: decorator3, decorator2, decorator1
end

class Example
    @log
    @validate(someValidator)
    @readonly
    property: string
    -- Applied in order: readonly, validate, log
end
</code></pre>
<h3 id="gettersetter-decorators"><a class="header" href="#gettersetter-decorators">Getter/Setter Decorators</a></h3>
<p>Decorate getters and setters:</p>
<pre><code class="language-lua">function memoize(target: any, key: string, descriptor: any): void
    const cache = {}

    const originalGetter = descriptor.get

    descriptor.get = function(self)
        if cache[self] == nil then
            cache[self] = originalGetter(self)
        end
        return cache[self]
    end
end

class ExpensiveCalculator
    private data: number[]

    constructor(data: number[])
        self.data = data
    end

    @memoize
    get sum(): number
        print("Computing sum...")
        local total = 0
        for _, value in ipairs(self.data) do
            total = total + value
        end
        return total
    end
end

const calc = ExpensiveCalculator.new({1, 2, 3, 4, 5})
print(calc.sum)  -- Computing sum... 15
print(calc.sum)  -- 15 (cached, no recomputation)
</code></pre>
<h3 id="operator-decorator"><a class="header" href="#operator-decorator">Operator Decorator</a></h3>
<p>Decorate operator overloads:</p>
<pre><code class="language-lua">function commutative(target: any, key: string, descriptor: any): void
    const originalOp = descriptor.value

    descriptor.value = function(self, other)
        -- Try both orders
        const result = originalOp(self, other) or originalOp(other, self)
        return result
    end
end

class Value
    private value: number

    constructor(value: number)
        self.value = value
    end

    @commutative
    operator +(other: Value): Value
        return Value.new(self.value + other.value)
    end
end
</code></pre>
<h3 id="built-in-decorators"><a class="header" href="#built-in-decorators">Built-in Decorators</a></h3>
<p>LuaNext provides several built-in decorators:</p>
<h4 id="readonly"><a class="header" href="#readonly">@readonly</a></h4>
<p>Mark properties as read-only:</p>
<pre><code class="language-lua">class Config
    @readonly
    version: string

    constructor(version: string)
        self.version = version
    end
end

const config = Config.new("1.0.0")
-- config.version = "2.0.0"  -- ❌ Error
</code></pre>
<h4 id="sealed"><a class="header" href="#sealed">@sealed</a></h4>
<p>Prevent class extension:</p>
<pre><code class="language-lua">@sealed
class FinalClass
    -- Cannot be extended
end
</code></pre>
<h4 id="deprecated"><a class="header" href="#deprecated">@deprecated</a></h4>
<p>Mark members as deprecated:</p>
<pre><code class="language-lua">class API
    @deprecated
    function oldMethod(): void
        print("Old method")
    end

    @deprecated("Use newMethod2() instead")
    function newMethod(): void
        print("New method")
    end
end
</code></pre>
<h3 id="decorator-factory-pattern"><a class="header" href="#decorator-factory-pattern">Decorator Factory Pattern</a></h3>
<p>Create configurable decorators:</p>
<pre><code class="language-lua">function retry(maxAttempts: number, delay: number): (target: any, key: string, descriptor: any) =&gt; void
    return function(target, key, descriptor)
        const originalMethod = descriptor.value

        descriptor.value = function(self, ...)
            local attempts = 0

            while attempts &lt; maxAttempts do
                attempts = attempts + 1

                const success, result = pcall(function()
                    return originalMethod(self, ...)
                end)

                if success then
                    return result
                end

                if attempts &lt; maxAttempts then
                    print(`Retry ${attempts}/${maxAttempts} after ${delay}ms`)
                    sleep(delay)
                end
            end

            error(`Failed after ${maxAttempts} attempts`)
        end
    end
end

class NetworkClient
    @retry(3, 1000)
    function fetchData(url: string): string
        -- May fail, will retry up to 3 times
        return httpGet(url)
    end
end
</code></pre>
<h3 id="type-safe-decorators"><a class="header" href="#type-safe-decorators">Type-Safe Decorators</a></h3>
<p>Decorators with proper typing:</p>
<pre><code class="language-lua">type PropertyDecorator = (target: any, propertyKey: string) =&gt; void
type MethodDecorator = (target: any, propertyKey: string, descriptor: PropertyDescriptor) =&gt; void
type ClassDecorator = (constructor: any) =&gt; void

function enumerable(value: boolean): PropertyDecorator
    return function(target, propertyKey)
        -- Set enumerable property
        target.__enumerable = target.__enumerable or {}
        target.__enumerable[propertyKey] = value
    end
end

class Example
    @enumerable(false)
    private secret: string

    @enumerable(true)
    public data: string
end
</code></pre>
<h3 id="decorator-composition"><a class="header" href="#decorator-composition">Decorator Composition</a></h3>
<p>Combine decorators for complex behavior:</p>
<pre><code class="language-lua">function compose(...decorators: ((target: any, key: string, descriptor: any) =&gt; void)[]): (target: any, key: string, descriptor: any) =&gt; void
    return function(target, key, descriptor)
        for i = #decorators, 1, -1 do
            decorators[i](target, key, descriptor)
        end
    end
end

const logAndValidate = compose(log, validate(someValidator))

class Service
    @logAndValidate
    function process(data: string): void
        -- Both logging and validation applied
    end
end
</code></pre>
<h2 id="details"><a class="header" href="#details">Details</a></h2>
<h3 id="decorator-targets"><a class="header" href="#decorator-targets">Decorator Targets</a></h3>
<p>Decorators can be applied to:</p>
<ol>
<li><strong>Classes</strong> — Modify class constructors</li>
<li><strong>Properties</strong> — Modify property descriptors</li>
<li><strong>Methods</strong> — Modify method descriptors</li>
<li><strong>Getters</strong> — Modify getter descriptors</li>
<li><strong>Setters</strong> — Modify setter descriptors</li>
<li><strong>Operators</strong> — Modify operator overload descriptors</li>
</ol>
<h3 id="decorator-signatures"><a class="header" href="#decorator-signatures">Decorator Signatures</a></h3>
<p>Different decorator types have different signatures:</p>
<pre><code class="language-lua">-- Class decorator
type ClassDecorator = (constructor: any) =&gt; void

-- Property decorator
type PropertyDecorator = (target: any, propertyKey: string) =&gt; void

-- Method decorator
type MethodDecorator = (target: any, propertyKey: string, descriptor: PropertyDescriptor) =&gt; void
</code></pre>
<h3 id="execution-order"><a class="header" href="#execution-order">Execution Order</a></h3>
<p>When multiple decorators are applied:</p>
<ol>
<li><strong>Decorators are evaluated</strong> top-to-bottom</li>
<li><strong>Decorators are executed</strong> bottom-to-top</li>
</ol>
<pre><code class="language-lua">@first   -- Evaluated 1st, executed 3rd
@second  -- Evaluated 2nd, executed 2nd
@third   -- Evaluated 3rd, executed 1st
class MyClass
end
</code></pre>
<h3 id="propertydescriptor"><a class="header" href="#propertydescriptor">PropertyDescriptor</a></h3>
<p>Method decorators receive a PropertyDescriptor:</p>
<pre><code class="language-lua">interface PropertyDescriptor
    value: any          -- The method function
    writable: boolean   -- Can be reassigned
    enumerable: boolean -- Appears in iteration
    configurable: boolean -- Can be deleted or reconfigured
end
</code></pre>
<h3 id="decorator-metadata"><a class="header" href="#decorator-metadata">Decorator Metadata</a></h3>
<p>Store metadata on decorated members:</p>
<pre><code class="language-lua">function metadata(key: string, value: any): (target: any, propertyKey: string) =&gt; void
    return function(target, propertyKey)
        target.__metadata = target.__metadata or {}
        target.__metadata[propertyKey] = target.__metadata[propertyKey] or {}
        target.__metadata[propertyKey][key] = value
    end
end

class User
    @metadata("required", true)
    @metadata("minLength", 3)
    name: string
end

-- Access metadata
const nameMetadata = User.__metadata.name
print(nameMetadata.required)   -- true
print(nameMetadata.minLength)  -- 3
</code></pre>
<h3 id="compile-time-vs-runtime"><a class="header" href="#compile-time-vs-runtime">Compile-Time vs Runtime</a></h3>
<p>Decorators are:</p>
<ul>
<li><strong>Evaluated at compile time</strong> — Decorator expressions are resolved during compilation</li>
<li><strong>Executed at runtime</strong> — Decorator functions run when the class is defined</li>
</ul>
<h3 id="decorator-limitations"><a class="header" href="#decorator-limitations">Decorator Limitations</a></h3>
<ul>
<li>Cannot add new properties to classes (Lua limitation)</li>
<li>Cannot change property types</li>
<li>Limited reflection capabilities</li>
</ul>
<h3 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h3>
<ol>
<li><strong>Keep decorators pure</strong> — Avoid side effects</li>
<li><strong>Document behavior</strong> — Clearly describe what decorators do</li>
<li><strong>Use type annotations</strong> — Provide proper types for decorator functions</li>
<li><strong>Compose carefully</strong> — Be mindful of decorator interaction</li>
<li><strong>Test thoroughly</strong> — Decorators modify behavior in non-obvious ways</li>
</ol>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="classes.html">Classes</a> — Class and member declarations</li>
<li><a href="advanced-types.html">Advanced Types</a> — Type utilities for decorators</li>
<li><a href="../reference/reflection.html">Reflection</a> — Runtime reflection API</li>
</ul>

                </section>

                </div><!-- page-inner -->

            </div><!-- page-wrapper -->

            </div><!-- book-inner -->

            <!-- Version Selector -->
            <nav class="nav-wide-wrapper" aria-label="More">
                <a href="javascript:void(0)" id="menu-bar-wide" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </a>
            </nav>

            <!-- Version selector dropdown -->
            <div id="version-selector" class="version-selector">
                <select id="version-picker" onchange="switchVersion(this.value)" aria-label="Documentation version">
                    <option value="latest">Latest</option>
                </select>
            </div>

        </div><!-- book -->

        <!-- Custom scripts -->
        <script>
            // Version selector functionality
            function switchVersion(version) {
                const base = window.location.origin + '/luanext/';
                if (version === 'latest') {
                    window.location.href = base;
                } else {
                    window.location.href = base + version + '/';
                }
            }

            // Load versions.json and populate selector if it exists
            fetch('/luanext/versions.json')
                .then(response => response.json())
                .then(data => {
                    if (data.versions && data.versions.length > 1) {
                        const selector = document.getElementById('version-picker');
                        data.versions.forEach(v => {
                            if (v.version !== 'latest') {
                                const option = document.createElement('option');
                                option.value = 'v' + v.version;
                                option.textContent = 'v' + v.version;
                                selector.appendChild(option);
                            }
                        });
                    }
                })
                .catch(() => {
                    // versions.json not found (expected during initial setup)
                    // Selector will only show "Latest"
                });
        </script>

        <!-- mdBook scripts and content scripts -->
        <script src="js/clipboard.min.js" type="text/javascript"></script>
        <script src="js/highlight.js" type="text/javascript"></script>
        <script src="js/book.js" type="text/javascript"></script>

        <!-- Custom theme script -->
        <script src="js/custom-theme.js" type="text/javascript"></script>

        <script src="js/elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/lunr-en.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/search.js" type="text/javascript" charset="utf-8"></script>

    </body>
</html>
