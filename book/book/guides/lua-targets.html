<!DOCTYPE html>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Fallback to default mdbook template -->
        
        <meta name="robots" content="noindex,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8">
        <title>Lua Targets - LuaNext Documentation</title>
        <script>
            var theme = localStorage.getItem("mdbook-theme");
            if (theme === null || theme === undefined) { theme = "light"; }
            var html = document.querySelector("html");
            html.classList.remove("light");
            html.classList.add(theme);
        </script>
        <meta name="description" content="A typed superset of Lua with gradual typing, inspired by TypeScript">
        <link rel="icon" href="favicon.svg">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/custom.css">
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

    </head>
    <body>
        <!-- Provide the book title to JavaScript -->
        <script>
            window.book = window.book || {};
            window.book.language = "en";
        </script>

        <div id="book" class="book">
            <div class="book-inner">

            <nav role="navigation" aria-label="Table of contents" class="sidebar">
                <ol class="chapter"><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="introduction.html">Introduction</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Language</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/basics.html"><strong aria-hidden="true">1.</strong> Basics</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/control-flow.html"><strong aria-hidden="true">2.</strong> Control Flow</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/functions.html"><strong aria-hidden="true">3.</strong> Functions</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/type-system.html"><strong aria-hidden="true">4.</strong> Type System</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/classes.html"><strong aria-hidden="true">5.</strong> Classes</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/interfaces.html"><strong aria-hidden="true">6.</strong> Interfaces</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/enums.html"><strong aria-hidden="true">7.</strong> Enums</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/modules.html"><strong aria-hidden="true">8.</strong> Modules</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/error-handling.html"><strong aria-hidden="true">9.</strong> Error Handling</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/pattern-matching.html"><strong aria-hidden="true">10.</strong> Pattern Matching</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/decorators.html"><strong aria-hidden="true">11.</strong> Decorators</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/advanced-types.html"><strong aria-hidden="true">12.</strong> Advanced Types</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/operators.html"><strong aria-hidden="true">13.</strong> Operators</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Guides</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="guides/migrating-from-lua.html"><strong aria-hidden="true">14.</strong> Migrating from Lua</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="guides/lua-targets.html"><strong aria-hidden="true">15.</strong> Lua Targets</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Reference</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/cli.html"><strong aria-hidden="true">16.</strong> CLI</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/configuration.html"><strong aria-hidden="true">17.</strong> Configuration</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/standard-library.html"><strong aria-hidden="true">18.</strong> Standard Library</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/utility-types.html"><strong aria-hidden="true">19.</strong> Utility Types</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/reflection.html"><strong aria-hidden="true">20.</strong> Reflection API</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/error-codes.html"><strong aria-hidden="true">21.</strong> Error Codes</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/grammar.html"><strong aria-hidden="true">22.</strong> Grammar</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/keywords.html"><strong aria-hidden="true">23.</strong> Keywords</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Contributing</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="contributing/setup.html"><strong aria-hidden="true">24.</strong> Getting Started</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">API Reference</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="api/index.html"><strong aria-hidden="true">25.</strong> Rust API Docs</a></span></li></ol>
            </nav>

            <div id="page-wrapper" class="page-wrapper">

                <div class="page-inner">

                <section class="normal" id="main">
                    <h1 id="targeting-different-lua-versions"><a class="header" href="#targeting-different-lua-versions">Targeting Different Lua Versions</a></h1>
<p>LuaNext can target Lua versions 5.1, 5.2, 5.3, and 5.4. This guide explains the differences, compatibility patterns, and how to choose the right target for your project.</p>
<h2 id="quick-reference"><a class="header" href="#quick-reference">Quick Reference</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Version</th><th>Released</th><th>Key Features</th><th>Compatibility</th></tr>
</thead>
<tbody>
<tr><td><strong>Lua 5.1</strong></td><td>2006</td><td>Module system, <code>setfenv</code>/<code>getfenv</code></td><td>Widest compatibility</td></tr>
<tr><td><strong>Lua 5.2</strong></td><td>2011</td><td><code>goto</code>, <code>_ENV</code>, bit32 library</td><td>Breaking changes from 5.1</td></tr>
<tr><td><strong>Lua 5.3</strong></td><td>2015</td><td>Native integers, bitwise operators</td><td>Mostly compatible with 5.2</td></tr>
<tr><td><strong>Lua 5.4</strong></td><td>2020</td><td><code>&lt;const&gt;</code>, <code>&lt;close&gt;</code>, new metamethods</td><td>Latest features</td></tr>
</tbody>
</table>
</div>
<h2 id="setting-the-target"><a class="header" href="#setting-the-target">Setting the Target</a></h2>
<h3 id="in-configuration-file"><a class="header" href="#in-configuration-file">In Configuration File</a></h3>
<pre><code class="language-yaml"># luanext.config.yaml
compilerOptions:
  target: "5.4"  # Options: "5.1", "5.2", "5.3", "5.4"
</code></pre>
<h3 id="command-line"><a class="header" href="#command-line">Command Line</a></h3>
<pre><code class="language-bash"># Target Lua 5.1
luanext --target 5.1 main.luax

# Target Lua 5.4
luanext --target 5.4 main.luax
</code></pre>
<h3 id="default-target"><a class="header" href="#default-target">Default Target</a></h3>
<p>If not specified, LuaNext targets <strong>Lua 5.4</strong> (latest features).</p>
<h2 id="choosing-a-target"><a class="header" href="#choosing-a-target">Choosing a Target</a></h2>
<h3 id="use-lua-51-when"><a class="header" href="#use-lua-51-when">Use Lua 5.1 When</a></h3>
<ul>
<li><strong>Maximum compatibility needed</strong> — Most embedded Lua uses 5.1</li>
<li><strong>Legacy systems</strong> — Older games, applications using Lua 5.1</li>
<li><strong>Widest deployment</strong> — 5.1 code runs everywhere</li>
<li><strong>Embedded environments</strong> — Many game engines and applications use 5.1</li>
</ul>
<h3 id="use-lua-52-when"><a class="header" href="#use-lua-52-when">Use Lua 5.2 When</a></h3>
<ul>
<li><strong>You need <code>goto</code></strong> — For complex control flow (state machines, etc.)</li>
<li><strong><code>_ENV</code> manipulation needed</strong> — For sandboxing or environment control</li>
<li><strong>5.1 is too old</strong> — But 5.3+ features aren’t critical</li>
</ul>
<h3 id="use-lua-53-when"><a class="header" href="#use-lua-53-when">Use Lua 5.3 When</a></h3>
<ul>
<li><strong>Native integers needed</strong> — For performance with whole numbers</li>
<li><strong>Bitwise operators</strong> — For bit manipulation (games, protocols)</li>
<li><strong>UTF-8 library</strong> — For Unicode string handling</li>
<li><strong>Better performance</strong> — Integer optimizations help</li>
</ul>
<h3 id="use-lua-54-when"><a class="header" href="#use-lua-54-when">Use Lua 5.4 When</a></h3>
<ul>
<li><strong>Latest features</strong> — <code>&lt;const&gt;</code>, <code>&lt;close&gt;</code>, generational GC</li>
<li><strong>New metamethods</strong> — <code>__close</code> for resource management</li>
<li><strong>Best performance</strong> — Latest optimizations</li>
<li><strong>No legacy constraints</strong> — New projects with modern Lua</li>
</ul>
<h2 id="feature-compatibility-matrix"><a class="header" href="#feature-compatibility-matrix">Feature Compatibility Matrix</a></h2>
<h3 id="language-features"><a class="header" href="#language-features">Language Features</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>5.1</th><th>5.2</th><th>5.3</th><th>5.4</th><th>Notes</th></tr>
</thead>
<tbody>
<tr><td>Basic syntax</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>—</td></tr>
<tr><td>Metatables</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>—</td></tr>
<tr><td>Coroutines</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>—</td></tr>
<tr><td><code>goto</code></td><td>❌</td><td>✅</td><td>✅</td><td>✅</td><td>Emulated in 5.1</td></tr>
<tr><td><code>_ENV</code></td><td>❌</td><td>✅</td><td>✅</td><td>✅</td><td>Uses <code>setfenv</code> in 5.1</td></tr>
<tr><td>Native integers</td><td>❌</td><td>❌</td><td>✅</td><td>✅</td><td>Type-checked only in 5.1/5.2</td></tr>
<tr><td>Bitwise ops</td><td>❌</td><td>❌</td><td>✅</td><td>✅</td><td>Uses bit32/bit library in 5.1/5.2</td></tr>
<tr><td>Integer division (<code>//</code>)</td><td>❌</td><td>❌</td><td>✅</td><td>✅</td><td>Emulated with <code>math.floor(a/b)</code></td></tr>
<tr><td><code>&lt;const&gt;</code> variables</td><td>❌</td><td>❌</td><td>❌</td><td>✅</td><td>Type-checked only in 5.1-5.3</td></tr>
<tr><td><code>&lt;close&gt;</code> variables</td><td>❌</td><td>❌</td><td>❌</td><td>✅</td><td>Not available in older versions</td></tr>
</tbody>
</table>
</div>
<h3 id="standard-library"><a class="header" href="#standard-library">Standard Library</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Library</th><th>5.1</th><th>5.2</th><th>5.3</th><th>5.4</th><th>Notes</th></tr>
</thead>
<tbody>
<tr><td><code>table.*</code></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>Some functions moved in 5.2+</td></tr>
<tr><td><code>string.*</code></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>—</td></tr>
<tr><td><code>math.*</code></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>—</td></tr>
<tr><td><code>io.*</code></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>—</td></tr>
<tr><td><code>os.*</code></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>—</td></tr>
<tr><td><code>module()</code></td><td>✅</td><td>⚠️</td><td>❌</td><td>❌</td><td>Deprecated in 5.2, removed in 5.3</td></tr>
<tr><td><code>setfenv/getfenv</code></td><td>✅</td><td>❌</td><td>❌</td><td>❌</td><td>Replaced by <code>_ENV</code></td></tr>
<tr><td><code>bit32.*</code></td><td>❌</td><td>✅</td><td>✅</td><td>⚠️</td><td>Deprecated in 5.3 (use bitwise ops)</td></tr>
<tr><td><code>utf8.*</code></td><td>❌</td><td>❌</td><td>✅</td><td>✅</td><td>—</td></tr>
<tr><td><code>table.pack/unpack</code></td><td>⚠️</td><td>✅</td><td>✅</td><td>✅</td><td>Use <code>unpack</code> in 5.1</td></tr>
<tr><td><code>table.move</code></td><td>❌</td><td>❌</td><td>✅</td><td>✅</td><td>—</td></tr>
</tbody>
</table>
</div>
<p>Legend: ✅ Available | ❌ Not available | ⚠️ Deprecated/Changed</p>
<h2 id="code-generation-differences"><a class="header" href="#code-generation-differences">Code Generation Differences</a></h2>
<h3 id="integers"><a class="header" href="#integers">Integers</a></h3>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">const count: integer = 42
const index: integer = #array
</code></pre>
<p><strong>Compiles to (5.3+):</strong></p>
<pre><code class="language-lua">local count = 42
local index = #array
</code></pre>
<p><strong>Compiles to (5.1/5.2):</strong></p>
<pre><code class="language-lua">-- Same output, but type is checked at compile time only
local count = 42
local index = #array
</code></pre>
<p><strong>Note:</strong> In 5.1/5.2, <code>integer</code> is a type annotation only. In 5.3+, Lua uses actual integer type internally for performance.</p>
<h3 id="bitwise-operators"><a class="header" href="#bitwise-operators">Bitwise Operators</a></h3>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">const a: integer = 12 &amp; 10   -- AND
const b: integer = 12 | 10   -- OR
const c: integer = 12 ~ 10   -- XOR
const d: integer = ~5        -- NOT
const e: integer = 1 &lt;&lt; 3    -- Left shift
const f: integer = 8 &gt;&gt; 2    -- Right shift
</code></pre>
<p><strong>Compiles to (5.3+):</strong></p>
<pre><code class="language-lua">local a = 12 &amp; 10
local b = 12 | 10
local c = 12 ~ 10
local d = ~5
local e = 1 &lt;&lt; 3
local f = 8 &gt;&gt; 2
</code></pre>
<p><strong>Compiles to (5.2):</strong></p>
<pre><code class="language-lua">-- Uses bit32 library
local a = bit32.band(12, 10)
local b = bit32.bor(12, 10)
local c = bit32.bxor(12, 10)
local d = bit32.bnot(5)
local e = bit32.lshift(1, 3)
local f = bit32.rshift(8, 2)
</code></pre>
<p><strong>Compiles to (5.1):</strong></p>
<pre><code class="language-lua">-- Uses polyfill or external bit library
local a = bit.band(12, 10)
local b = bit.bor(12, 10)
local c = bit.bxor(12, 10)
local d = bit.bnot(5)
local e = bit.lshift(1, 3)
local f = bit.rshift(8, 2)
</code></pre>
<h3 id="integer-division"><a class="header" href="#integer-division">Integer Division</a></h3>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">const result: number = 17 // 5  -- Floor division
</code></pre>
<p><strong>Compiles to (5.3+):</strong></p>
<pre><code class="language-lua">local result = 17 // 5
</code></pre>
<p><strong>Compiles to (5.1/5.2):</strong></p>
<pre><code class="language-lua">local result = math.floor(17 / 5)
</code></pre>
<h3 id="table-operations"><a class="header" href="#table-operations">Table Operations</a></h3>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">const packed = table.pack(1, 2, 3, 4, 5)
const moved = table.move(source, 1, 5, 1, dest)
</code></pre>
<p><strong>Compiles to (5.2+):</strong></p>
<pre><code class="language-lua">local packed = table.pack(1, 2, 3, 4, 5)
local moved = table.move(source, 1, 5, 1, dest)
</code></pre>
<p><strong>Compiles to (5.1):</strong></p>
<pre><code class="language-lua">-- Polyfill for table.pack
local function pack(...)
    return {n = select("#", ...), ...}
end
local packed = pack(1, 2, 3, 4, 5)

-- Polyfill for table.move
local function move(a1, f, e, t, a2)
    a2 = a2 or a1
    for i = 0, e - f do
        a2[t + i] = a1[f + i]
    end
    return a2
end
local moved = move(source, 1, 5, 1, dest)
</code></pre>
<h3 id="module-system"><a class="header" href="#module-system">Module System</a></h3>
<p><strong>LuaNext:</strong></p>
<pre><code class="language-lua">-- ES6-style imports/exports
import {add, multiply} from "./math-utils"
export function divide(a: number, b: number): number
    return a / b
end
</code></pre>
<p><strong>Compiles to (All versions):</strong></p>
<pre><code class="language-lua">-- Uses require and module pattern
local math_utils = require("math-utils")
local add = math_utils.add
local multiply = math_utils.multiply

local M = {}

function M.divide(a, b)
    return a / b
end

return M
</code></pre>
<p><strong>Note:</strong> Module compilation is the same across all Lua versions. LuaNext uses the return-table pattern, not <code>module()</code>.</p>
<h2 id="cross-version-compatibility-patterns"><a class="header" href="#cross-version-compatibility-patterns">Cross-Version Compatibility Patterns</a></h2>
<h3 id="writing-portable-code"><a class="header" href="#writing-portable-code">Writing Portable Code</a></h3>
<p>Use LuaNext features that work across all versions:</p>
<pre><code class="language-lua">-- ✅ Portable: Basic types
const name: string = "Alice"
const count: number = 42

-- ✅ Portable: Functions
function add(a: number, b: number): number
    return a + b
end

-- ✅ Portable: Interfaces
interface Point
    x: number
    y: number
end

-- ✅ Portable: Arrays and tables
const numbers: number[] = {1, 2, 3}
const point: Point = {x = 1, y = 2}
</code></pre>
<h3 id="avoid-version-specific-features"><a class="header" href="#avoid-version-specific-features">Avoid Version-Specific Features</a></h3>
<p>If targeting multiple versions:</p>
<pre><code class="language-lua">-- ❌ Avoid in portable code (5.3+ only)
const flags: integer = 0b1100
const result: integer = flags &amp; 0b1010

-- ✅ Use instead (all versions)
const flags: number = 12
const result: number = bitwiseAnd(flags, 10)  -- Custom function
</code></pre>
<h3 id="conditional-compilation"><a class="header" href="#conditional-compilation">Conditional Compilation</a></h3>
<p>LuaNext doesn’t support <code>#ifdef</code> style conditionals. Instead:</p>
<p><strong>Option 1: Configuration-based</strong></p>
<pre><code class="language-yaml"># luanext-5.1.config.yaml
compilerOptions:
  target: "5.1"
  defines:
    USE_BIT_LIBRARY: true

# luanext-5.3.config.yaml
compilerOptions:
  target: "5.3"
  defines:
    USE_BIT_LIBRARY: false
</code></pre>
<p><strong>Option 2: Runtime detection</strong></p>
<pre><code class="language-lua">-- Detect Lua version at runtime
const luaVersion = tonumber(_VERSION:match("%d+%.%d+"))

function bitwiseAnd(a: number, b: number): number
    if luaVersion &gt;= 5.3 then
        return a &amp; b
    else
        return bit32.band(a, b)
    end
end
</code></pre>
<h2 id="testing-across-versions"><a class="header" href="#testing-across-versions">Testing Across Versions</a></h2>
<h3 id="using-multiple-lua-installations"><a class="header" href="#using-multiple-lua-installations">Using Multiple Lua Installations</a></h3>
<pre><code class="language-bash"># Test with Lua 5.1
lua5.1 output.lua

# Test with Lua 5.3
lua5.3 output.lua

# Test with Lua 5.4
lua5.4 output.lua
</code></pre>
<h3 id="docker-testing"><a class="header" href="#docker-testing">Docker Testing</a></h3>
<pre><code class="language-dockerfile"># Dockerfile
FROM alpine:latest

RUN apk add --no-cache lua5.1 lua5.3 lua5.4

COPY dist/ /app/
WORKDIR /app

CMD ["lua5.4", "main.lua"]
</code></pre>
<h3 id="cicd-matrix-testing"><a class="header" href="#cicd-matrix-testing">CI/CD Matrix Testing</a></h3>
<pre><code class="language-yaml"># .github/workflows/test.yml
strategy:
  matrix:
    lua-version: ['5.1', '5.2', '5.3', '5.4']
steps:
  - name: Setup Lua
    uses: leafo/gh-actions-lua@v9
    with:
      luaVersion: ${{ matrix.lua-version }}
  - name: Run tests
    run: lua test/all_tests.lua
</code></pre>
<h2 id="performance-considerations"><a class="header" href="#performance-considerations">Performance Considerations</a></h2>
<h3 id="version-performance-characteristics"><a class="header" href="#version-performance-characteristics">Version Performance Characteristics</a></h3>
<p><strong>Lua 5.1:</strong></p>
<ul>
<li><strong>Wide compatibility</strong> — Runs on most platforms and embedded systems</li>
<li><strong>Best for</strong> — Legacy applications, maximum compatibility</li>
<li><strong>Limitations</strong> — No native integers, older standard library, no bitwise operators</li>
</ul>
<p><strong>Lua 5.3:</strong></p>
<ul>
<li><strong>Good integer performance</strong> — Native 64-bit integers</li>
<li><strong>Bitwise operators</strong> — Faster than library calls</li>
<li><strong>Best for</strong> — Numerical applications, bit manipulation</li>
</ul>
<p><strong>Lua 5.4:</strong></p>
<ul>
<li><strong>Generational GC</strong> — Better for applications with many short-lived objects</li>
<li><strong>Best for</strong> — Modern applications, long-running servers</li>
<li><strong>Latest optimizations</strong> — Most recent performance improvements</li>
</ul>
<h3 id="optimization-by-target"><a class="header" href="#optimization-by-target">Optimization by Target</a></h3>
<p><strong>For Lua 5.1:</strong></p>
<pre><code class="language-lua">-- Use number everywhere (no integer optimization)
function sum(arr: number[]): number
    local total: number = 0
    for i = 1, #arr do
        total = total + arr[i]
    end
    return total
end
</code></pre>
<p><strong>For Lua 5.3+:</strong></p>
<pre><code class="language-lua">-- Use integer for loops and counters
function sum(arr: number[]): number
    local total: number = 0
    for i: integer = 1, #arr do
        total = total + arr[i]
    end
    return total
end
</code></pre>
<h2 id="migration-between-versions"><a class="header" href="#migration-between-versions">Migration Between Versions</a></h2>
<h3 id="upgrading-from-51-to-53"><a class="header" href="#upgrading-from-51-to-53">Upgrading from 5.1 to 5.3+</a></h3>
<p><strong>Changes needed:</strong></p>
<ol>
<li><strong>Replace <code>bit</code> library with operators:</strong></li>
</ol>
<pre><code class="language-lua">-- Before (5.1)
const result = bit.band(a, b)

-- After (5.3+)
const result = a &amp; b
</code></pre>
<ol>
<li><strong>Replace <code>module()</code> with return pattern:</strong></li>
</ol>
<pre><code class="language-lua">-- Before (5.1)
module("mymodule")
function foo() end

-- After (all versions via LuaNext)
export function foo(): void end
</code></pre>
<ol>
<li><strong>Use <code>table.pack</code> instead of <code>arg</code> table:</strong></li>
</ol>
<pre><code class="language-lua">-- Before (5.1)
function varargs(...)
    const args = arg
end

-- After (5.2+)
function varargs(...: any[])
    const args = table.pack(...)
end
</code></pre>
<h3 id="downgrading-from-54-to-51"><a class="header" href="#downgrading-from-54-to-51">Downgrading from 5.4 to 5.1</a></h3>
<p><strong>Changes needed:</strong></p>
<ol>
<li><strong>Remove <code>&lt;const&gt;</code> and <code>&lt;close&gt;</code></strong> — LuaNext handles this automatically</li>
<li><strong>Avoid bitwise operators</strong> — Use functions instead</li>
<li><strong>Test with polyfills</strong> — Ensure compatibility functions work</li>
</ol>
<h2 id="summary"><a class="header" href="#summary">Summary</a></h2>
<h3 id="quick-decision-guide"><a class="header" href="#quick-decision-guide">Quick Decision Guide</a></h3>
<pre><code class="language-text">Need wide compatibility?  → Target 5.1
Need bitwise operators?   → Target 5.3+
Need latest features?     → Target 5.4
Building new project?     → Target 5.4
Legacy system support?    → Target 5.1
</code></pre>
<h3 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h3>
<ol>
<li><strong>Choose target based on deployment environment</strong></li>
<li><strong>Test on actual target Lua version</strong></li>
<li><strong>Use portable LuaNext features when possible</strong></li>
<li><strong>Avoid version-specific Lua features</strong></li>
<li><strong>Document target version requirements</strong></li>
</ol>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<ul>
<li><a href="migrating-from-lua.html">Migrating from Lua</a> — Porting Lua code to LuaNext</li>
<li><a href="../reference/configuration.html">Configuration</a> — All compiler options</li>
<li><a href="../reference/cli.html">CLI Reference</a> — Command-line usage</li>
</ul>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="migrating-from-lua.html">Migrating from Lua</a> — Porting Lua code to LuaNext</li>
<li><a href="../reference/configuration.html">Configuration</a> — All compiler options</li>
<li><a href="../reference/cli.html">CLI Reference</a> — Command-line usage</li>
<li><a href="../reference/standard-library.html">Standard Library</a> — Typed standard library</li>
<li><a href="https://www.lua.org/manual/">Lua Manual</a> — Official Lua documentation</li>
</ul>

                </section>

                </div><!-- page-inner -->

            </div><!-- page-wrapper -->

            </div><!-- book-inner -->

            <!-- Version Selector -->
            <nav class="nav-wide-wrapper" aria-label="More">
                <a href="javascript:void(0)" id="menu-bar-wide" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </a>
            </nav>

            <!-- Version selector dropdown -->
            <div id="version-selector" class="version-selector">
                <select id="version-picker" onchange="switchVersion(this.value)" aria-label="Documentation version">
                    <option value="latest">Latest</option>
                </select>
            </div>

        </div><!-- book -->

        <!-- Custom scripts -->
        <script>
            // Version selector functionality
            function switchVersion(version) {
                const base = window.location.origin + '/luanext/';
                if (version === 'latest') {
                    window.location.href = base;
                } else {
                    window.location.href = base + version + '/';
                }
            }

            // Load versions.json and populate selector if it exists
            fetch('/luanext/versions.json')
                .then(response => response.json())
                .then(data => {
                    if (data.versions && data.versions.length > 1) {
                        const selector = document.getElementById('version-picker');
                        data.versions.forEach(v => {
                            if (v.version !== 'latest') {
                                const option = document.createElement('option');
                                option.value = 'v' + v.version;
                                option.textContent = 'v' + v.version;
                                selector.appendChild(option);
                            }
                        });
                    }
                })
                .catch(() => {
                    // versions.json not found (expected during initial setup)
                    // Selector will only show "Latest"
                });
        </script>

        <!-- mdBook scripts and content scripts -->
        <script src="js/clipboard.min.js" type="text/javascript"></script>
        <script src="js/highlight.js" type="text/javascript"></script>
        <script src="js/book.js" type="text/javascript"></script>

        <!-- Custom theme script -->
        <script src="js/custom-theme.js" type="text/javascript"></script>

        <script src="js/elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/lunr-en.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/search.js" type="text/javascript" charset="utf-8"></script>

    </body>
</html>
