<!DOCTYPE html>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Fallback to default mdbook template -->
        
        <meta name="robots" content="noindex,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8">
        <title>Pattern Matching - LuaNext Documentation</title>
        <script>
            var theme = localStorage.getItem("mdbook-theme");
            if (theme === null || theme === undefined) { theme = "light"; }
            var html = document.querySelector("html");
            html.classList.remove("light");
            html.classList.add(theme);
        </script>
        <meta name="description" content="A typed superset of Lua with gradual typing, inspired by TypeScript">
        <link rel="icon" href="favicon.svg">
        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/custom.css">
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">

    </head>
    <body>
        <!-- Provide the book title to JavaScript -->
        <script>
            window.book = window.book || {};
            window.book.language = "en";
        </script>

        <div id="book" class="book">
            <div class="book-inner">

            <nav role="navigation" aria-label="Table of contents" class="sidebar">
                <ol class="chapter"><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="introduction.html">Introduction</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Language</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/basics.html"><strong aria-hidden="true">1.</strong> Basics</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/control-flow.html"><strong aria-hidden="true">2.</strong> Control Flow</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/functions.html"><strong aria-hidden="true">3.</strong> Functions</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/type-system.html"><strong aria-hidden="true">4.</strong> Type System</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/classes.html"><strong aria-hidden="true">5.</strong> Classes</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/interfaces.html"><strong aria-hidden="true">6.</strong> Interfaces</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/enums.html"><strong aria-hidden="true">7.</strong> Enums</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/modules.html"><strong aria-hidden="true">8.</strong> Modules</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/error-handling.html"><strong aria-hidden="true">9.</strong> Error Handling</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/pattern-matching.html"><strong aria-hidden="true">10.</strong> Pattern Matching</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/decorators.html"><strong aria-hidden="true">11.</strong> Decorators</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/advanced-types.html"><strong aria-hidden="true">12.</strong> Advanced Types</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="language/operators.html"><strong aria-hidden="true">13.</strong> Operators</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Guides</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="guides/migrating-from-lua.html"><strong aria-hidden="true">14.</strong> Migrating from Lua</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="guides/lua-targets.html"><strong aria-hidden="true">15.</strong> Lua Targets</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Reference</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/cli.html"><strong aria-hidden="true">16.</strong> CLI</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/configuration.html"><strong aria-hidden="true">17.</strong> Configuration</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/standard-library.html"><strong aria-hidden="true">18.</strong> Standard Library</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/utility-types.html"><strong aria-hidden="true">19.</strong> Utility Types</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/reflection.html"><strong aria-hidden="true">20.</strong> Reflection API</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/error-codes.html"><strong aria-hidden="true">21.</strong> Error Codes</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/grammar.html"><strong aria-hidden="true">22.</strong> Grammar</a></span></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="reference/keywords.html"><strong aria-hidden="true">23.</strong> Keywords</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">Contributing</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="contributing/setup.html"><strong aria-hidden="true">24.</strong> Getting Started</a></span></li><li class="chapter-item expanded "><li class="spacer"></li></li><li class="chapter-item expanded "><li class="part-title">API Reference</li></li><li class="chapter-item expanded "><span class="chapter-link-wrapper"><a href="api/index.html"><strong aria-hidden="true">25.</strong> Rust API Docs</a></span></li></ol>
            </nav>

            <div id="page-wrapper" class="page-wrapper">

                <div class="page-inner">

                <section class="normal" id="main">
                    <h1 id="pattern-matching"><a class="header" href="#pattern-matching">Pattern Matching</a></h1>
<p>Pattern matching provides a powerful way to destructure and test values. LuaNext supports match expressions with identifier, literal, array, object, wildcard, and or patterns, along with guards for conditional matching.</p>
<h2 id="syntax"><a class="header" href="#syntax">Syntax</a></h2>
<pre><code class="language-lua">match expression
    | pattern [if guard] -&gt; expression
    | pattern [if guard] -&gt; expression
    | pattern [if guard] -&gt;
        -- block
    end
end
</code></pre>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<h3 id="basic-pattern-matching"><a class="header" href="#basic-pattern-matching">Basic Pattern Matching</a></h3>
<p>Match against literal values:</p>
<pre><code class="language-lua">function getStatusMessage(code: number): string
    return match code
        | 200 -&gt; "OK"
        | 404 -&gt; "Not Found"
        | 500 -&gt; "Internal Server Error"
        | _ -&gt; "Unknown Status"
    end
end

print(getStatusMessage(200))  -- OK
print(getStatusMessage(999))  -- Unknown Status
</code></pre>
<p>Compiles to:</p>
<pre><code class="language-lua">local function getStatusMessage(code)
    local _match = code
    if _match == 200 then
        return "OK"
    elseif _match == 404 then
        return "Not Found"
    elseif _match == 500 then
        return "Internal Server Error"
    else
        return "Unknown Status"
    end
end

print(getStatusMessage(200))
print(getStatusMessage(999))
</code></pre>
<h3 id="identifier-pattern"><a class="header" href="#identifier-pattern">Identifier Pattern</a></h3>
<p>Bind values to identifiers:</p>
<pre><code class="language-lua">const value = 42

const result = match value
    | x -&gt; x * 2
end

print(result)  -- 84
</code></pre>
<h3 id="wildcard-pattern"><a class="header" href="#wildcard-pattern">Wildcard Pattern</a></h3>
<p>The wildcard pattern <code>_</code> matches any value without binding:</p>
<pre><code class="language-lua">function isPositive(x: number): boolean
    return match x
        | 0 -&gt; false
        | _ if x &gt; 0 -&gt; true
        | _ -&gt; false
    end
end
</code></pre>
<h3 id="array-patterns"><a class="header" href="#array-patterns">Array Patterns</a></h3>
<p>Destructure arrays with pattern matching:</p>
<pre><code class="language-lua">function describeArray(arr: number[]): string
    return match arr
        | [] -&gt; "Empty array"
        | [x] -&gt; `Single element: ${x}`
        | [x, y] -&gt; `Two elements: ${x}, ${y}`
        | [x, y, z] -&gt; `Three elements: ${x}, ${y}, ${z}`
        | _ -&gt; "More than three elements"
    end
end

print(describeArray({}))         -- Empty array
print(describeArray({1}))        -- Single element: 1
print(describeArray({1, 2}))     -- Two elements: 1, 2
print(describeArray({1, 2, 3}))  -- Three elements: 1, 2, 3
print(describeArray({1, 2, 3, 4}))  -- More than three elements
</code></pre>
<h3 id="rest-pattern"><a class="header" href="#rest-pattern">Rest Pattern</a></h3>
<p>Capture remaining array elements:</p>
<pre><code class="language-lua">function getFirstAndRest(arr: number[]): {first: number, rest: number[]}
    return match arr
        | [] -&gt; {first = 0, rest = {}}
        | [first, ...rest] -&gt; {first = first, rest = rest}
    end
end

const result = getFirstAndRest({1, 2, 3, 4})
print(result.first)        -- 1
print(#result.rest)        -- 3
print(result.rest[1])      -- 2
</code></pre>
<h3 id="object-patterns"><a class="header" href="#object-patterns">Object Patterns</a></h3>
<p>Destructure objects/tables:</p>
<pre><code class="language-lua">interface Point
    x: number
    y: number
end

function describePoint(p: Point): string
    return match p
        | {x = 0, y = 0} -&gt; "Origin"
        | {x = 0, y} -&gt; `On Y axis at ${y}`
        | {x, y = 0} -&gt; `On X axis at ${x}`
        | {x, y} -&gt; `Point at (${x}, ${y})`
    end
end

print(describePoint({x = 0, y = 0}))   -- Origin
print(describePoint({x = 0, y = 5}))   -- On Y axis at 5
print(describePoint({x = 3, y = 0}))   -- On X axis at 3
print(describePoint({x = 3, y = 4}))   -- Point at (3, 4)
</code></pre>
<h3 id="guards"><a class="header" href="#guards">Guards</a></h3>
<p>Add conditional checks to patterns:</p>
<pre><code class="language-lua">function classifyNumber(x: number): string
    return match x
        | 0 -&gt; "Zero"
        | n if n &gt; 0 and n &lt; 10 -&gt; "Small positive"
        | n if n &gt;= 10 and n &lt; 100 -&gt; "Medium positive"
        | n if n &gt;= 100 -&gt; "Large positive"
        | n if n &lt; 0 -&gt; "Negative"
        | _ -&gt; "Unknown"
    end
end

print(classifyNumber(0))    -- Zero
print(classifyNumber(5))    -- Small positive
print(classifyNumber(50))   -- Medium positive
print(classifyNumber(150))  -- Large positive
print(classifyNumber(-5))   -- Negative
</code></pre>
<h3 id="or-patterns"><a class="header" href="#or-patterns">Or Patterns</a></h3>
<p>Match multiple patterns in one arm:</p>
<pre><code class="language-lua">function isWeekend(day: string): boolean
    return match day
        | "Saturday" | "Sunday" -&gt; true
        | _ -&gt; false
    end
end

print(isWeekend("Saturday"))  -- true
print(isWeekend("Monday"))    -- false
</code></pre>
<h3 id="nested-patterns"><a class="header" href="#nested-patterns">Nested Patterns</a></h3>
<p>Patterns can be nested:</p>
<pre><code class="language-lua">interface User
    name: string
    address: {city: string, zip: string}
end

function getCityFromUser(user: User): string
    return match user
        | {address = {city}} -&gt; city
        | _ -&gt; "Unknown city"
    end
end

const user: User = {
    name = "Alice",
    address = {city = "New York", zip = "10001"}
}

print(getCityFromUser(user))  -- New York
</code></pre>
<h3 id="matching-enums"><a class="header" href="#matching-enums">Matching Enums</a></h3>
<p>Pattern matching works excellently with enums:</p>
<pre><code class="language-lua">enum Status
    Pending,
    Active,
    Completed,
    Failed
end

function getColor(status: Status): string
    return match status
        | Status.Pending -&gt; "yellow"
        | Status.Active -&gt; "green"
        | Status.Completed -&gt; "blue"
        | Status.Failed -&gt; "red"
    end
end

const status = Status.Active
print(getColor(status))  -- green
</code></pre>
<h3 id="block-bodies"><a class="header" href="#block-bodies">Block Bodies</a></h3>
<p>Match arms can have block bodies:</p>
<pre><code class="language-lua">function processValue(x: number): number
    return match x
        | 0 -&gt;
            print("Zero detected")
            return 1
        end
        | n if n &lt; 0 -&gt;
            print("Negative number")
            return -n
        end
        | n -&gt;
            print("Positive number")
            return n * 2
        end
    end
end
</code></pre>
<h3 id="exhaustiveness-checking"><a class="header" href="#exhaustiveness-checking">Exhaustiveness Checking</a></h3>
<p>The compiler warns if not all cases are handled:</p>
<pre><code class="language-lua">enum Color
    Red,
    Green,
    Blue
end

function getName(color: Color): string
    return match color
        | Color.Red -&gt; "red"
        | Color.Green -&gt; "green"
        -- Missing Color.Blue!
        -- Warning: Non-exhaustive match
    end
end

-- Use wildcard to ensure exhaustiveness:
function getName2(color: Color): string
    return match color
        | Color.Red -&gt; "red"
        | Color.Green -&gt; "green"
        | _ -&gt; "other"
    end
end
</code></pre>
<h3 id="matching-complex-types"><a class="header" href="#matching-complex-types">Matching Complex Types</a></h3>
<p>Match against complex union types:</p>
<pre><code class="language-lua">type Result&lt;T, E&gt; = {success: true, value: T} | {success: false, error: E}

function handleResult&lt;T&gt;(result: Result&lt;T, string&gt;): T | nil
    return match result
        | {success = true, value} -&gt; value
        | {success = false, error} -&gt;
            print(`Error: ${error}`)
            return nil
        end
    end
end

const result1: Result&lt;number, string&gt; = {success = true, value = 42}
const result2: Result&lt;number, string&gt; = {success = false, error = "Failed"}

print(handleResult(result1))  -- 42
print(handleResult(result2))  -- nil (prints "Error: Failed")
</code></pre>
<h3 id="matching-optional-values"><a class="header" href="#matching-optional-values">Matching Optional Values</a></h3>
<p>Handle nullable values:</p>
<pre><code class="language-lua">function getLength(str: string | nil): number
    return match str
        | nil -&gt; 0
        | s -&gt; #s
    end
end

print(getLength(nil))      -- 0
print(getLength("hello"))  -- 5
</code></pre>
<h3 id="pattern-matching-in-variable-declarations"><a class="header" href="#pattern-matching-in-variable-declarations">Pattern Matching in Variable Declarations</a></h3>
<p>Destructure in variable declarations:</p>
<pre><code class="language-lua">const [x, y, z] = {1, 2, 3}
print(x, y, z)  -- 1 2 3

const {name, age} = {name = "Alice", age = 30}
print(name, age)  -- Alice 30

-- With rest pattern
const [first, ...rest] = {1, 2, 3, 4, 5}
print(first)     -- 1
print(#rest)     -- 4
</code></pre>
<h3 id="pattern-matching-in-function-parameters"><a class="header" href="#pattern-matching-in-function-parameters">Pattern Matching in Function Parameters</a></h3>
<p>Destructure function parameters:</p>
<pre><code class="language-lua">function distance(p1: {x: number, y: number}, p2: {x: number, y: number}): number
    return math.sqrt((p2.x - p1.x) ^ 2 + (p2.y - p1.y) ^ 2)
end

-- With destructuring:
function distance2({x = x1, y = y1}: {x: number, y: number}, {x = x2, y = y2}: {x: number, y: number}): number
    return math.sqrt((x2 - x1) ^ 2 + (y2 - y1) ^ 2)
end
</code></pre>
<h3 id="matching-multiple-values"><a class="header" href="#matching-multiple-values">Matching Multiple Values</a></h3>
<p>Match against tuples:</p>
<pre><code class="language-lua">function classifyPoint(x: number, y: number): string
    return match {x, y}
        | {0, 0} -&gt; "Origin"
        | {0, _} -&gt; "Y axis"
        | {_, 0} -&gt; "X axis"
        | {x, y} if x == y -&gt; "Diagonal"
        | _ -&gt; "Other"
    end
end

print(classifyPoint(0, 0))  -- Origin
print(classifyPoint(0, 5))  -- Y axis
print(classifyPoint(3, 0))  -- X axis
print(classifyPoint(5, 5))  -- Diagonal
print(classifyPoint(3, 4))  -- Other
</code></pre>
<h2 id="details"><a class="header" href="#details">Details</a></h2>
<h3 id="pattern-types"><a class="header" href="#pattern-types">Pattern Types</a></h3>
<p>LuaNext supports six pattern types:</p>
<ol>
<li><strong>Identifier</strong> — <code>x</code>, <code>name</code>, <code>value</code> (binds to variable)</li>
<li><strong>Literal</strong> — <code>42</code>, <code>"hello"</code>, <code>true</code>, <code>nil</code> (exact match)</li>
<li><strong>Array</strong> — <code>[x, y, z]</code>, <code>[first, ...rest]</code> (array destructuring)</li>
<li><strong>Object</strong> — <code>{x, y}</code>, <code>{name = n, age}</code> (object destructuring)</li>
<li><strong>Wildcard</strong> — <code>_</code> (matches anything, no binding)</li>
<li><strong>Or</strong> — <code>Red | Green | Blue</code> (match any alternative)</li>
</ol>
<h3 id="guard-evaluation"><a class="header" href="#guard-evaluation">Guard Evaluation</a></h3>
<p>Guards are evaluated left to right:</p>
<pre><code class="language-lua">match x
    | n if n &gt; 10 -&gt; "large"   -- Checked first
    | n if n &gt; 5 -&gt; "medium"   -- Checked if first guard fails
    | _ -&gt; "small"              -- Fallback
end
</code></pre>
<h3 id="pattern-precedence"><a class="header" href="#pattern-precedence">Pattern Precedence</a></h3>
<p>Patterns are matched in order:</p>
<pre><code class="language-lua">match x
    | _ -&gt; "first"   -- Always matches, later patterns unreachable
    | 42 -&gt; "second" -- Warning: Unreachable pattern
end
</code></pre>
<p>Put more specific patterns before general ones:</p>
<pre><code class="language-lua">match x
    | 42 -&gt; "forty-two"
    | _ -&gt; "other"
end
</code></pre>
<h3 id="exhaustiveness"><a class="header" href="#exhaustiveness">Exhaustiveness</a></h3>
<p>Match expressions must handle all cases:</p>
<ul>
<li>Use wildcard <code>_</code> as catch-all</li>
<li>Or handle all enum variants explicitly</li>
<li>Compiler warns on non-exhaustive matches</li>
</ul>
<h3 id="array-pattern-constraints"><a class="header" href="#array-pattern-constraints">Array Pattern Constraints</a></h3>
<ul>
<li>Rest pattern <code>...rest</code> must be last</li>
<li>Can have at most one rest pattern</li>
<li>Holes <code>_</code> skip elements: <code>[x, _, z]</code></li>
</ul>
<h3 id="object-pattern-constraints"><a class="header" href="#object-pattern-constraints">Object Pattern Constraints</a></h3>
<ul>
<li>Properties can be bound or matched</li>
<li><code>{x}</code> is shorthand for <code>{x = x}</code></li>
<li><code>{x = value}</code> binds <code>x</code> to <code>value</code></li>
</ul>
<h3 id="match-expression-return-types"><a class="header" href="#match-expression-return-types">Match Expression Return Types</a></h3>
<p>All arms must return the same type:</p>
<pre><code class="language-lua">const result: string = match x
    | 0 -&gt; "zero"
    | 1 -&gt; "one"
    | _ -&gt; "many"
end
</code></pre>
<p>Different return types cause type error:</p>
<pre><code class="language-lua">-- Error: Type mismatch
const result = match x
    | 0 -&gt; "zero"   -- string
    | 1 -&gt; 1        -- number (error!)
end
</code></pre>
<h3 id="performance"><a class="header" href="#performance">Performance</a></h3>
<p>Pattern matching compiles to efficient if-else chains:</p>
<ul>
<li>Literal comparisons use <code>==</code></li>
<li>Array/object patterns check structure</li>
<li>Guards evaluated only when pattern matches</li>
<li>No runtime overhead for exhaustiveness checking</li>
</ul>
<h2 id="see-also"><a class="header" href="#see-also">See Also</a></h2>
<ul>
<li><a href="enums.html">Enums</a> — Pattern matching with enums</li>
<li><a href="type-system.html">Type System</a> — Union types and narrowing</li>
<li><a href="functions.html">Functions</a> — Destructuring parameters</li>
<li><a href="basics.html">Basics</a> — Destructuring variable declarations</li>
</ul>

                </section>

                </div><!-- page-inner -->

            </div><!-- page-wrapper -->

            </div><!-- book-inner -->

            <!-- Version Selector -->
            <nav class="nav-wide-wrapper" aria-label="More">
                <a href="javascript:void(0)" id="menu-bar-wide" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                    <i class="fa fa-bars"></i>
                </a>
            </nav>

            <!-- Version selector dropdown -->
            <div id="version-selector" class="version-selector">
                <select id="version-picker" onchange="switchVersion(this.value)" aria-label="Documentation version">
                    <option value="latest">Latest</option>
                </select>
            </div>

        </div><!-- book -->

        <!-- Custom scripts -->
        <script>
            // Version selector functionality
            function switchVersion(version) {
                const base = window.location.origin + '/luanext/';
                if (version === 'latest') {
                    window.location.href = base;
                } else {
                    window.location.href = base + version + '/';
                }
            }

            // Load versions.json and populate selector if it exists
            fetch('/luanext/versions.json')
                .then(response => response.json())
                .then(data => {
                    if (data.versions && data.versions.length > 1) {
                        const selector = document.getElementById('version-picker');
                        data.versions.forEach(v => {
                            if (v.version !== 'latest') {
                                const option = document.createElement('option');
                                option.value = 'v' + v.version;
                                option.textContent = 'v' + v.version;
                                selector.appendChild(option);
                            }
                        });
                    }
                })
                .catch(() => {
                    // versions.json not found (expected during initial setup)
                    // Selector will only show "Latest"
                });
        </script>

        <!-- mdBook scripts and content scripts -->
        <script src="js/clipboard.min.js" type="text/javascript"></script>
        <script src="js/highlight.js" type="text/javascript"></script>
        <script src="js/book.js" type="text/javascript"></script>

        <!-- Custom theme script -->
        <script src="js/custom-theme.js" type="text/javascript"></script>

        <script src="js/elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/lunr-en.js" type="text/javascript" charset="utf-8"></script>
        <script src="js/search.js" type="text/javascript" charset="utf-8"></script>

    </body>
</html>
